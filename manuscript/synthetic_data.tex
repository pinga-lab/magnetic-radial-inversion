\section{Application to synthetic data}

To examine the performance of our inversion method, we present two applications with total-field anomaly data simulating two different isolated geological sources. The first source is a funnel-shaped model with a simple geometry, which satisfies all of the constraints described in Section \ref{sec:metodo}. The aim of this test is to evaluate the regularization in an ideal case with simple geometry. The second source has a complex geometry, which does not satisfy any constraint. The purpose, here, is to show that the constraints can stabilize the inverse problem in a more realistic case retrieving the geometry of the source with known magnetization using the polygonal prisms.

In both applications, the synthetic total-field anomaly was computed in an irregular grid on plane $z=-150$ m and contaminated with pseudo-random Gaussian noise sequences with mean zero and different standard deviation. In both cases, we considered the main magnetic field with an inclination and declination of $-21.5^\circ$ and $-18.7^\circ$, respectively. Also, the total-magnetization direction of the models is the same with a strong remnant component of $(-50^\circ,9^\circ)$ for inclination and declination, respectively .

Although the simulated sources have a different depth to the top, we have considered both known. We also assumed the same magnetization for all prisms of the magnetic sources. On the other hand, the depth extent of the sources was not set in the initial guesses because it is a parameter for the inverse problem. Moreover, we have investigated the influence of the parameters from the initial guess on the solution by varying them and evaluating the effect on the misfit function.

\subsection{Simple model test}

The first synthetic source has $L=8$ prisms, each one with $M = 20$ vertices, and a purely induced magnetization with $m_0 = 9$ A/m. Its depth to the top is at $z_0=0$ m and the bottom is at $1600$ m. The radii of the vertices are equal within the same prism and decrease along the depth with a step of $160$ m starting with $r_j^k=1920$ m, $j=1,\dots, M$ (Figure \ref{fig:kimb_model}b). The horizontal coordinates $x_0$ and $y_0$ of the origins of the polygons $O^k$ are equal to $(0,0)$ for all prisms. We calculated the synthetic data produced by this source on an area of $100$ km$^2$, simulating an airborne survey composed of $20$ flight lines that are equally spaced with $500$ m between them along the horizontal coordinate $y$, at a constant vertical coordinate $z=-150$ m (Figure \ref{fig:kimb_model}a).

To define the best pair of $z_0$ and $ m_0 $, we used a strategy of multiple inversions (\ref{fig:kimb_map}) for ranges of both parameters of the source. This strategy is based on the prerogative that the best pair is the one that gives us the lowest value of $\Gamma$ (\ref{eq:gamma}). In this case, the ranges of the parameters of the source contain the true values, which are represented by the red triangle in Fig. \ref{fig:kimb_map}. As expected, the pair of true values gives us the lowest value of $\Gamma$ and, consequently, the best estimation of the source's shape.

The solution with the pair of true values of $z_0$ and $ m_0 $ (red triangle in Fig. \ref{fig:kimb_map}) gives us the fitting shown in Fig. \ref{fig:kimb_results}a. to estimate this solution, we used an interpretation model formed by $L=5$ prisms, each one with $M=20$ vertices. The prisms forming the initial approximation have the same radii for all vertices ($2000$ m) and depth extent ($350$ m), so the maximum depth is equal to $1750$ m. We have used all constraints described in Section 2 except the third and fourth constraints. We weighted the constraints with $\tilde{\alpha}_1 = 10^{-4}$, $\tilde{\alpha}_2 = 10^{-4}$, $\tilde{\alpha}_5 = 10^{-4}$, $\tilde{\alpha}_6 = 10^{-6}$, and $\tilde{\alpha}_7 = 10^{-4}$. Both Cartesian coordinates $x_0^k$ and $y_0^k$ of the origins of all prisms $O^k$, $k=1,\dots,L$, are located at the point $(0,0)$ of the area. The estimate retrieves the source's shape accurately (Fig. \ref{fig:kimb_results}c and d). The red prisms are very close to the edges of the true body (blue lines) even using fewer prisms than the true body has. Moreover, the estimated depth extent of each prism is $dz = 200.65$ m, which gives us a very accurate total depth extent of $1203.88$ m. 

\subsection{Complex model test}

The second synthetic source has $L=10$ prisms, each one with $M=30$ vertices, and a total magnetization with $m_0 =12$ A/m. The complex model has both induced and remnant magnetization with inclination $-50$ยบ, and declination $9$ยบ. Its depth to the top is at $z_0=200$ m and its bottom is at $5700$ m. The radii of the vertices ($r_j^k$, $j=1,\dots,M$, $k=1,\dots,L$) forming this synthetic body vary from $240$ to $1540$ m and the horizontal coordinates $x_0$ and $y_0$ of the origins of the polygons $O^k$ vary from $-250$ m and $250$ m to $750$ m and $-750$ m, respectively (Figure \ref{fig:complex_model}b) by an equal step for both of $100$ m. We calculated the synthetic data produced by this body, simulating an airborne survey covering an area of $100$ km$^2$ composed of 20 flight lines that are equally spaced from $-5000$ m to $5000$ m and one tie line located at $x=0$ m, along with the horizontal coordinate $y$, and with a height of $-150$ m (Figure \ref{fig:complex_model}a). We introduced an uncertainty in both coordinates of the observation points $x$, $y$, and $z$.

We used the same strategy applied to simple model to define $z_0$ and $ m_0 $. In this case, we chose ranges that do not include the true values of the source's parameters. Therefore, the best solutions are expected to be $\Gamma$ closer to the true values (red triangle in the map). In Fig. \ref{fig:complex_map}, we show the \ref{eq:gamma} values for the multiple solutions and, also, the red triangle indicates the true pair of $z_0$ and $ m_0 $ and the cyan diamond represents the best pair considering the chosen ranges. As we can see, the lower values of $\Gamma$ are close to the true pair of $z_0$ and $ m_0 $.

For this case, the initial guess is a cylinder formed by $L=8$ prisms, each one with $M=15$ vertices centered at $(x_0^k, y_0^k) = (-300,300)$. All prisms that form the initial approximation have the same $r_i = 800$, $i = 1, \dots, V$, m and depth extent $dz=650$ m (Figure \ref{fig:complex_model}a). We set the weights for the constraints $\tilde{\alpha}_1 = 10^{-4}$, $\tilde{\alpha}_2 = 10^{-4}$, $\tilde{\alpha}_5 = 10^{-4}$, $\tilde{\alpha}_6 = 10^{-7}$, and $\tilde{\alpha}_7 = 10^{-4}$. Again, the third and fourth constraints were not used. Fig. \ref{fig:complex_result}a shows the fitting of the inversion of the noise-corrupted total-field anomaly in Fig. \ref{fig:complex_model}a. The residuals have a mean and a standard deviation very close to the values of the noise also the histogram is coherent with a Gaussian distribution (Figure \ref{fig:complex_result})a. Due to the lower number of prisms in the interpretation model, the estimated body does not retrieve perfectly the simulated body. However, the volume of the complex model is $12.60$ km$^3$, while the volume of the estimated source is $12.81$ km$^3$. Moreover, the estimated depth extent is $6145.12$ m, which is very close to $6000$ m. 


%In both tests, from the initial guesses (red prisms in Figures 4a e 5a), the method provided estimates that fit the data and retrieve the geometry of the simulated bodies (red prisms in Figures 4b and 5b). Overall, the method can closely estimate the geometries of the simulated bodies and their bottom depths. The acceptable data fittings yielded by the estimated bodies are confirmed by the small residuals shown in Figures 4c and 5c. In both tests, the residuals are smaller than  $\pm 0.34$ nT and $\pm 18$ nT which correspond to less than $1\%$ of the total amplitude of their data sets.