\section{Application to synthetic data}\label{sec:synthetic}

\subsection{Simple model test}

We have simulated a lopolithic intrusion, a funnel-shaped source \cite[]{cawthorn-2018}, with simple geometry (blue prisms in Figs \ref{fig:simple_model}b and \ref{fig:simple_results}), which extends from $z_0=0$ m to $1\,600$ m along depth and satisfies most of the constraints described in subsection \ref{sec:constraints}. It is formed by $L=8$ prisms, all of them with the same number of vertices $ V = 20 $, thickness $ dz = 200 $ m and horizontal coordinates $ (x_0^k, y_0^k) = (0, 0) $ m of the origins $O^k$, $k=1,\dots,L$. The radii of all vertices are equal to each other within the same prism and decrease linearly with depth, varying from $r_j^0=1\,920$ m, at the shallowest prism, $r_j^L=800$ m, at the deepest prism, $j=1,\dots, V$. All prisms have the same total-magnetization direction with inclination $ -21.5^\circ $, declination $ -18.7^\circ $ and intensity $ m_0 = 9 $ A/m. We calculated the total-field anomaly produced by this simple model, in an area of $ 100 $ km$^2$ area, by simulating an airborne survey composed of $ 21 $ flight lines that are equally spaced $ 500 $ m apart along the y axis, at a constant vertical coordinate $ z = -150 $ m. At each line, there are $ 100 $ observation points spaced $101$ m apart along $ x $ axis. The total-field anomaly is corrupted with a pseudorandom Gaussian noise having mean $ \mu_0=0 $ nT and and standard deviation $ \sigma_0=5 $ nT (Fig. \ref{fig:simple_model}a).

We have inverted the noise-corrupted total-field anomaly (Fig. \ref{fig:simple_model}a) produced by the simulated lopolith-like body (blue prisms in Fig. \ref{fig:simple_model}b) and obtained 36 different estimates. Each estimate was obtained by using different pairs of depth to the top $ z_0 $ and total-magnetization intensity $ m_0 $ (Fig. \ref{fig:simple_map}). All estimates were generated by using the true values of total-magnetization inclination and declination, the same interpretation model formed by $ L = 5 $ prisms, each one with $ V = 20 $ vertices, and the same weights for the constraining functions: $\tilde{\alpha}_1 = 10^{-5}$, $\tilde{\alpha}_2 = 10^{-4}$, $\tilde{\alpha}_3 = 10^{-4}$, $\tilde{\alpha}_4 = 0$, $\tilde{\alpha}_5 = 0$, $\tilde{\alpha}_6 = 10^{-7}$, and $\tilde{\alpha}_7 = 10^{-6}$. In all inversions. the initial approximation for $\hat{\mathbf{p}}_{(0)}$ has the same constant radii $ r^k_j = 2000 $ m, $ k = 1, \dots, L $, $ j  = 1, \dots, V $, the same prism's thicknesses $ dz = 350 $ m and the same origins $(x^k_0, y^k_0) = (0, 0) $ m for all prisms.

Fig. \ref{fig:simple_map} shows the discrete mapping of the goal functional $ \Gamma(\mathbf{p}) $ (eq. \ref{eq:gamma}) on the plane of the total-magnetization intensity ($ m_0 $) versus depth to the top ($ z_0 $). The true values of depth to the top $ z_0 $ and total-magnetization intensity $ m_0 $ (represented by the red triangle in Fig. \ref{fig:simple_map}) produces the smallest value of goal function  $ \Gamma(\mathbf{p}) $ (eq. \ref{eq:gamma}). Fig. \ref{fig:simple_results}a shows that this estimated model (red prisms in Figs \ref{fig:simple_results}c and d) not only fits the noise-corrupted data, but also retrieves the geometry of the true model (blue prisms). The inset in Fig. \ref{fig:simple_results}a shows that the residuals follow a normal distribution with mean $ \mu $ and standard deviation $ \sigma $ compatible with those values used to generate the synthetic noise. The estimated thickness of each prism is $ dz = 297.65 $ m resulting in a depth-to-bottom estimate ($ 1\,485$ m) very close to the true one ($ 1\,600 $ m). 
These results illustrate the good performance of our method in an ideal case.

\subsection{Complex model test}

We have simulated a complex inclined body (blue prisms in Figs \ref{fig:complex_model} and \ref{fig:complex_result}) inspired by an alkaline vertical dipping intrusion. The simulated intrusion extends from $z_0=130$ m to $5270$ m along depth and violates most of the constraints described in subsection \ref{sec:constraints}. It is formed by $ L = 10 $ prisms, all of them with the same number of vertices $ V = 30 $ of thickness $ dz = 600 $ m. The horizontal coordinates of the origins $ O^k $ vary linearly from $ (x_0^0, y_0^0) = (-250, 750) $ m, at the shallowest prism, to $ (x_L^0, y_L^0) = (250, -750) $ m resulting a dip in the direction NW-SE, at the deepest prism. The displacements of the horizontal coordinates of the origins $O_k$ resulted in a simulated source dipping to northwest (blue prisms in Figs \ref{fig:complex_model} and \ref{fig:complex_result}). The radii $ r^k_j, k = 1, \dots, L$, $j = 1,\dots, V$, defining the vertices vary from $ 240 $ m to $ 1\,540 $ m and also differ from each other within the same prism. All prisms have a constant total magnetization with inclination $ -50^\circ $, declination $ 9^\circ $ and intensity $ m_0 = 12 $ A/m. We are simulating an alkaline vertical dipping intrusion. We have calculated the total-field anomaly produced by this complex model, in an area of $ 100 $ km$^2 $, by simulating an airborne survey composed of 18 north-south flight lines distributed from $ -5\,000 $ m to $ 5\,000 $ m along the y axis and a single east-west tie line approximately located at $ x = 0 $ m. The data points are located on the undulated surface shown in Fig. \ref{fig:complex_model}a. Notice that both flight and tie lines are not perfectly straight. To compute the synthetic total-field anomaly, we consider a constant main field with inclination $ -21.5^\circ $ and declination $ -18.7^\circ $, which is significantly different from the total-magnetization direction of the complex model. Finally, we have
contaminated the synthetic total-field anomaly with a pseudorandom Gaussian noise having mean and standard deviation equal to $0$ nT and $5$ nT, respectively (Fig. \ref{fig:complex_model}a).

We have inverted the noise-corrupted total-field anomaly (Fig. \ref{fig:complex_model}a) produced by the complex model by using 36 different pairs of depth to the top $ z_0 $
and total-magnetization intensity $ m_0 $ (Fig. \ref{fig:complex_map}). Differently from the previous simulation with a simple model, the present generated grid of $ m_0 $ and $ z_0 $ does not contain the true ones (represented by the red triangle in Fig. \ref{fig:complex_map}). All models were generated by using the true direction of the main geomagnetic field (i.e., inclination $ -21.5^\circ $ and declination $ -18.7^\circ $), the same interpretation model formed by $ L = 8 $ prisms, each one with $ V = 15 $ vertices, and the same weights for the constraining functions: $\tilde{\alpha}_1 = 10^{-5}$, $\tilde{\alpha}_2 = 10^{-4}$, $\tilde{\alpha}_3 = 10^{-4}$, $\tilde{\alpha}_4 = 0$, $\tilde{\alpha}_5 = 0$, $\tilde{\alpha}_6 = 10^{-7}$, and $\tilde{\alpha}_7 = 10^{-6}$. The initial approximation $ \hat{\mathbf{p}}_{(0)} $ for all inversions has the same constant radii $ r^k_j = 800 $ m, $ k = 1, \dots, L $, $ j = 1, \dots, V $, the same thickness $ dz = 650 $ m and the same origin $ (x^k_0, y^k_0) = (-300, 300) $ m for all prisms.

Fig. \ref{fig:complex_map} shows the goal function $ \Gamma(\mathbf{p}) $ (eq. \ref{eq:gamma}),
with different total-magnetization intensity $ m_0 $ and depth-to-the-top $z_0$ on the plane ($ m_0 \times z_0 $). We note that a minimum region (dark blue region in Fig. \ref{fig:complex_map}) contains the true pair of $ m_0 $ and  $ z_0 $  (red triangle  in Fig 7). However, we do not use the true  $ m_0 $ and $ z_0 $ to retrive the magnetized source because, intentionally in this test, our coarse mapping of the goal function $ \Gamma(\mathbf{p}) $ does not  include them.  Nevertheless, a well-defined minimum of the goal function value (pinpointed as the cyan diamond in Fig. \ref{fig:complex_map}) is achieved when the total-magnetization intensity $ m_0 = 11.4 $ A/m and depth to the top at $  z_0 = 150 $ m
These values of $ m_0 $ and $ z_0 $ will be used to retrieve the estimated model.

Fig. \ref{fig:complex_result} shows that the estimated model (red prisms in Figs \ref{fig:complex_result}c and d) fits the noise-corrupted data and also retrieves the geometry of the true source (blue prisms). 
Note that the red prisms edges accurately matches the blue prisms ones. 
The inset in Fig. \ref{fig:simple_results}a shows that the residuals follow a normal 
distribution with mean $ \mu $ and standard deviation $ \sigma $ compatible with those 
values used to generate the noise-corrupted data. 
The estimated of depth to the bottom  ($ 5\,682.2 $ m) and volume ($ 11.56 $ km$^3 $) are underestimated, but still close to the true values ($ 5\,570 $ m and $ 12.60 $ km$^3 $). 
These results show that our method can also be very useful to interpret complex sources, even if they do not perfectly satisfy the constraints imposed to solve the nonlinear inverse problem.